<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerador Pix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg:#f5f5f5; --card:#fff; --text:#000; --border:#ddd;
    }
    body.dark {
      --bg:#121212; --card:#1e1e1e; --text:#fff; --border:#333;
    }
    body {
      margin:0; padding:24px; font-family:Arial,sans-serif;
      background:var(--bg); color:var(--text);
    }
    .card {
      background:var(--card); border:1px solid var(--border);
      border-radius:8px; padding:16px; margin-bottom:16px;
    }
    h1 { font-size:20px; margin-bottom:12px; }
    label { display:block; margin-top:12px; font-weight:bold; }
    select, input, button {
      width:100%; padding:10px; margin-top:6px;
      font-size:16px;
    }
    button { cursor:pointer; }
    img { display:block; margin:16px auto; }
    textarea {
      width:100%; height:120px; margin-top:12px;
      font-size:12px;
    }
    .top {
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:16px;
    }
  </style>
</head>
<body>

<div class="top">
  <h1>Gerar Pix</h1>
  <button onclick="toggleDark()">ðŸŒ™</button>
</div>

<div class="card">
  <label>Chave Pix</label>
  <select id="chave">
    <option value="53984851730|Nubank">Nubank â€“ 53984851730</option>
    <option value="iigabrields@gmail.com|Inter">Inter â€“ iigabrields@gmail.com</option>
  </select>

  <label>Valor (R$)</label>
  <input id="valor" type="number" step="0.01" placeholder="Ex: 25.00">

  <label>DescriÃ§Ã£o (opcional)</label>
  <input id="desc" placeholder="Pagamento Pix">

  <button onclick="gerarPix()">Gerar Pix</button>
</div>

<div class="card" id="resultado" style="display:none;">
  <button onclick="copiar()">ðŸ“‹ Copiar Pix Copia e Cola</button>
  <textarea id="pixCode" readonly></textarea>
  <img id="qr" width="240" height="240">
</div>

<script>
/* ================= CRC16 ================= */
function crc16(payload) {
  let crc = 0xFFFF;
  for (let i = 0; i < payload.length; i++) {
    crc ^= payload.charCodeAt(i) << 8;
    for (let j = 0; j < 8; j++) {
      crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
    }
  }
  return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4,'0');
}

/* =============== EMV HELPERS ============== */
function campo(id, valor) {
  const tamanho = valor.length.toString().padStart(2,'0');
  return id + tamanho + valor;
}

/* ============== GERAR PIX ================= */
function gerarPix() {
  const [chave, alias] = document.getElementById("chave").value.split("|");
  const valor = document.getElementById("valor").value;
  const desc  = document.getElementById("desc").value || "Pagamento Pix";

  let payload =
    "000201" +
    campo("26",
      campo("00","BR.GOV.BCB.PIX") +
      campo("01", chave) +
      campo("02", desc)
    ) +
    "52040000" +
    "5303986";

  if (valor) {
    payload += campo("54", Number(valor).toFixed(2));
  }

  payload +=
    "5802BR" +
    campo("59","GABRIEL SEGUNDO") +
    campo("60","SAO PAULO") +
    "6304";

  const crc = crc16(payload);
  const pix = payload + crc;

  document.getElementById("pixCode").value = pix;
  document.getElementById("qr").src =
    "https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=" +
    encodeURIComponent(pix);

  document.getElementById("resultado").style.display = "block";
}

/* ============== UTIL ================= */
function copiar() {
  navigator.clipboard.writeText(
    document.getElementById("pixCode").value
  );
  alert("Pix Copia e Cola copiado");
}

function toggleDark() {
  document.body.classList.toggle("dark");
}
</script>

</body>
</html>
